define(["jquery","bootstrap"],function(t){"use strict";t.fn.form=function(i,e,r){r||"function"!=typeof e||(r=e),e||r||"function"!=typeof i||(r=i);var o=this;return o.render=function(i,e){o.schema=i,o.find("*").remove(),o.visiblityConditions=[];var r=t("<div class='row'>").appendTo(o);return function n(i,a){t.each(i,function(i,s){var l=a?a+"-"+i:i,u=o.getFieldValue(l,e);if("group"===s.type)n(s.values,l);else{var f,c={id:l,schema:s,value:"string"==typeof u?u.replace(/[&<>"'\/]/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}[t]}):u,title:s.title};c.control=o.form.templates[s.type]||o.form.templates.text,c.$control=c.control(c),f=c.control.wrapped?t(o.form.templates.wrapper(c)).appendTo(r).find("#"+l):t(c.$control).appendTo(r),s.show_if&&o.visiblityConditions.push({show_if:s.show_if,$field:f.closest(".form-group").parent()})}})}(o.schema),o.trigger("change")},o.set=function(i){return o.find("[name]").each(function(){var e=o.getFieldValue(this.name,i);"undefined"!=typeof e&&t(this).val(e)}),o.trigger("change")},o.toJSON=function(){var i=o.serializeArray(),e={};return t.each(i,function(){var i=this.name.split("-"),r=e,n=null,a=null,s=this.value;try{s=-1===["object","boolean"].indexOf(typeof JSON.parse(s))?s:JSON.parse(s)}catch(l){}t.each(i,function(){a=this,n=r,r[this]||(r[this]={}),r=r[this]});var u=o.find("#"+this.name);u.attr("multiple")||"checkbox"===u.attr("type")?n[a].push?n[a].push(s):n[a]=[s]:n[a]=s}),e},o.validate=function(i){var e=o.toJSON();o.find(".form-group.has-error").removeClass("has-error").tooltip("destroy");var n=[];return function a(i,r){t.each(i,function(t,i){var s=r?r+"-"+t:t,l=o.getFieldValue(s,e);if("group"===i.type)a(i.values,s);else if(i.required&&!l){if(i.show_if)for(var u in i.show_if)if(!o.getVisiblityCondition(i.show_if))return!0;n.push(o.find("#"+s))}})}(o.schema),n.length?setTimeout(function(){n.reverse().map(o.throwError)},150):("function"==typeof i?i:r).call(o,e),!1},o.throwError=function(t,i){var e=t.focus().closest(".form-group").addClass("has-error");return"string"==typeof i&&e.tooltip({title:i,trigger:"manual"}).tooltip("show"),o},o.throwErrors=function(t,i){for(var e in t)if(isNaN(t[e].length))o.throwErrors(t[e],(i?i+"-":"")+e);else for(var r=0;r<t[e].length;r++)o.throwError(o.find("#"+(i?i+"-":"")+e),t[e][r]);return o},o.getFieldValue=function(t,i){var e=t.split("-");return e.length>1?i?o.getFieldValue(e.slice(1).join("-"),i[e[0]]):void 0:i&&null!==i[t]?i[t]:void 0},o.updateVisiblityState=function(){for(var t=0;t<o.visiblityConditions.length;t++){var i=o.visiblityConditions[t].$field,e=o.visiblityConditions[t].show_if;i[o.getVisiblityCondition(e)?"show":"hide"]()}return o},o.getVisiblityCondition=function(t){return new Function("data","return "+t).call(o,o.toJSON())},o.render(i,e).off("submit",o.validate).on("submit",o.validate).off("input change",o.updateVisiblityState).on("input change",o.updateVisiblityState)}});
