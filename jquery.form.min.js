define(["jquery","bootstrap"],function(t){"use strict";t.fn.form=function(i,e,r){return r||"function"!=typeof e||(r=e),this.renderFields=function(){var r=this,n=r.find(".row");n.length||(n=t("<div class='row'>").appendTo(r));var o=[];return function s(i,u){t.each(i,function(i,f){var h=u?u+"-"+i:i,l=r.getFieldValue(h,e);if("group"===f.type)s(f.values,h);else{var a=n.append(r.form.template({controlId:h,fieldSchema:f,fieldData:"string"==typeof l?l.replace(/"/g,"&quot;"):l,fieldTitle:f.title}));f.show_if&&t.each(f.show_if,function(t,i){r.on("input change","#"+t,function(){-1!==i.indexOf(this.value)?a.closest(".form-group").show():a.closest(".form-group").hide()}),o.push(r.find("#"+t))})}})}(i),t.each(o,function(){this.trigger("change")}),r},this.onSubmit=function(){var e=this,n=this.toJSON();e.find(".form-group.has-error").removeClass("has-error").tooltip("destroy");var o=[];return function s(i,r){t.each(i,function(t,i){var u=r?r+"-"+t:t,f=e.getFieldValue(u,n);if("group"===i.type)s(i.values,u);else if(i.required&&!f){if(i.show_if)for(var h in i.show_if)if(-1===i.show_if[h].indexOf(e.find("#"+h).val()))return!0;o.push(e.find("#"+u))}})}(i),o.length?setTimeout(function(){o.reverse().map(e.throwError)},150):r.call(this,n),!1},this.throwError=function(t,i){var e=t.focus().closest(".form-group").addClass("has-error");"string"==typeof i&&e.tooltip({title:i,trigger:"manual"}).tooltip("show")},this.getFieldValue=function(t,i){var e=t.split("-");return e.length>1?i?this.getFieldValue(e.slice(1).join("-"),i[e[0]]):"":i&&null!==i[t]?i[t]:""},this.removeFields=function(){return this.find("*").remove(),this},this.toJSON=function(){var i=this,e=i.serializeArray(),r={};return t.each(e,function(){var e=this.name.split("-"),n=r,o=null,s=null,u=this.value;t.each(e,function(){s=this,o=n,n[this]||(n[this]={}),n=n[this]}),i.find("#"+this.name).attr("multiple")?o[s].push?o[s].push(u):o[s]=[u]:o[s]=u}),r},this.removeFields().renderFields().off("submit").on("submit",this.onSubmit.bind(this))}});
